name: Android CI

on:
  push:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify secret exists
        env:
          FLAVOR_CONFIG_JSON: ${{ secrets.FLAVORS }}
        run: |
          if [ -z "$FLAVOR_CONFIG_JSON" ]; then
              echo "❌ ERROR: FLAVOR_CONFIG_JSON secret is not set!"
              echo ""
              echo "Please add it in:"
              echo "Settings → Secrets and variables → Actions → New repository secret"
              echo ""
              echo "Name: FLAVOR_CONFIG_JSON"
              echo 'Value: {"flavors":[...]}'
              exit 1
          fi

          echo "✓ Secret is set (${#FLAVOR_CONFIG_JSON} characters)"

#      - name: Create and validate flavor config
#        env:
#          FLAVOR_CONFIG_BASE64: ${{ secrets.FLAVOR_CONFIG_BASE64 }}
#        run: |
#          echo "Step 1: Decode base64"
#          echo "$FLAVOR_CONFIG_BASE64" | tr -d '[:space:]' | base64 -d > flavor-config.json
#
#          echo ""
#          echo "Step 2: Check file"
#          ls -lh flavor-config.json
#          FILE_SIZE=$(wc -c < flavor-config.json)
#          echo "File size: $FILE_SIZE bytes"
#
#          if [ $FILE_SIZE -eq 0 ]; then
#              echo "ERROR: File is empty!"
#              exit 1
#          fi
#
#          echo ""
#          echo "Step 3: Check for null bytes"
#          if grep -q $'\x00' flavor-config.json; then
#              echo "ERROR: File contains null bytes!"
#              echo "Hex dump:"
#              hexdump -C flavor-config.json | head -20
#              exit 1
#          else
#              echo "✓ No null bytes"
#          fi
#
#          echo ""
#          echo "Step 4: Show content"
#          echo "Raw content:"
#          cat flavor-config.json
#
#          echo ""
#          echo "Step 5: Validate JSON"
#          if jq empty flavor-config.json 2>/dev/null; then
#              echo "✓ Valid JSON"
#              echo ""
#              echo "Formatted JSON:"
#              jq '.' flavor-config.json
#          else
#              echo "ERROR: Invalid JSON!"
#              echo "First 500 bytes (hex):"
#              hexdump -C flavor-config.json | head -30
#              exit 1
#          fi
#
#      - name: Set up JDK 17
#        uses: actions/setup-java@v4
#        with:
#          java-version: '17'
#          distribution: 'temurin'
#          cache: gradle
#
#      - name: Grant execute permission
#        run: chmod +x gradlew
#
#      - name: Build with verbose output
#        run: ./gradlew assembleDebug --info --stacktrace
#
#      - name: Upload APKs
#        if: success()
#        uses: actions/upload-artifact@v4
#        with:
#          name: apk-builds
#          path: app/build/outputs/apk/**/*.apk